---
import MainLayout from "../../layouts/mainLayout.astro"
import { getRepo } from "../../services/github"
import { getProjectDetails } from "../../services/server"
import { ProjectDetails } from "../../components/ProjectDetails/ProjectDetails"
import type { ProjectDetailsProps } from "../../components/ProjectDetails/types"
import "../../styles/pages/project.scss"

const { slug } = Astro.params

if (!slug) return Astro.redirect("/")

const data = await getRepo(slug)

if (!data) return Astro.redirect("/")

const {  full_name, name, liveDemo, repoLink, description, created_at, updated_at, language, visibility } = data

const {images} = await getProjectDetails(name)


const projectDetailsProps: ProjectDetailsProps = { 
	name, 
	repoLink, 
	liveDemo, 
	images, 
	description,
	language,
	created_at,
	updated_at,
	full_name,
	visibility,
}

---

<MainLayout title={name}>
	<ProjectDetails {...projectDetailsProps} client:load />
</MainLayout>